---
/* eslint max-lines: 'off' */

import {asset, fetchApi} from "../lib/data.js";
import {API_URL} from "../app/constants";

const noticeList = await fetchApi(`${API_URL}/cs`, {type: "N"})
.then((response) => response.json());

const noticeList2 = await fetchApi(`${API_URL}/cs`, {type: "F"})
.then((response) => response.json());

const notices = await noticeList?.noticeList.filter((item, idx) => idx < 3).map((notice) => {
	return {
		title: notice.title,
		content: notice.detail,
		createdAt: notice.date,
	};
});

const today = new Date().getFullYear() + '-' + ('0' + (new Date().getMonth() + 1)).slice(-2) + '-' + ('0' + new Date().getDate()).slice(-2);

/*
const moneys = [4900, 2500, 6700, 8900, 5600, 9900,
	6000, 10900, 84000, 75900, 90000, 82000,
	60100, 99700, 81000, 92400, 83100, 77300,
	62500, 79900, 47300, 70200, 16000, 9800,];
let summary = 0;
moneys.forEach((money) => {
	summary += money;
});

console.log(summary);
*/


const numberWithCommas = (x: number): string => {
	return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}
/*
 * chart 등의 포맷은 여기에서만 쓸 것 같아서 component 화 하지 않고 그냥 구현
*/
---

<div class="p-4">
	<div class="grid w-full grid-cols-1 gap-4 xl:grid-cols-1 2xl:grid-cols-2">
		<!-- Left widget -->
		<div class="grid gap-4 shadow-sm ">
			<!-- Today payment -->
			<div class="items-center justify-between p-4 bg-white border border-gray-200 rounded-lg shadow-sm sm:flex dark:border-gray-700 sm:p-4 dark:bg-gray-800">
				<div>
					<h3 class="text-gray-500 dark:text-gray-400">오늘 정산 예정 금액</h3>
					<span class="flex items-center mr-1.5 text-sm text-green-500 dark:text-green-400"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path clip-rule="evenodd" fill-rule="evenodd" d="M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z"></path></svg><h4 class="text-xl font-bold dark:text-white">1,234,124</h4>원</span>
				</div>
			</div>
			<!-- Today payment -->
			<div class="items-center justify-between p-4 bg-white border border-gray-200 rounded-lg shadow-sm sm:flex dark:border-gray-700 sm:p-4 dark:bg-gray-800">
				<div>
					<h3 class="text-gray-500 dark:text-gray-400">오늘 정산 예정 금액</h3>
					<span class="flex items-center mr-1.5 text-sm text-green-500 dark:text-green-400"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path clip-rule="evenodd" fill-rule="evenodd" d="M10 17a.75.75 0 01-.75-.75V5.612L5.29 9.77a.75.75 0 01-1.08-1.04l5.25-5.5a.75.75 0 011.08 0l5.25 5.5a.75.75 0 11-1.08 1.04l-3.96-4.158V16.25A.75.75 0 0110 17z"></path></svg><h4 class="text-xl font-bold dark:text-white">1,234,124</h4>원</span>
				</div>
			</div>
			<div class="bg-white border border-gray-200 rounded-lg shadow-sm 2xl:col-span-2 dark:border-gray-700 dark:bg-gray-800 px-4 pt-4 sm:px-4 sm:pt-4">
				<div class="w-full mb-4 sm:mb-0">
					<div class="flex items-center justify-between">
						<h3 class="text-base font-normal text-gray-500 dark:text-gray-400">
							시간대별 매출액 | 단위: 원(1K = 1,000)
						</h3>
						{today}
					</div>
					<span class="text-2xl font-bold leading-none text-gray-900 sm:text-3xl dark:text-white">{numberWithCommas(1166600)} 원</span>
					
					
					<button data-popover-target="time-sales-description" data-popover-placement="bottom-end" type="button">
						<svg class="w-4 h-4 ml-2 text-gray-400 hover:text-gray-500" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
						</svg>
						<span class="sr-only">Show information</span>
					</button>
					<div data-popover id="time-sales-description" role="tooltip" class="absolute z-10 invisible inline-block text-sm font-light text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 w-72 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-400">
						<div class="p-3 space-y-2">
							<h3 class="font-semibold text-gray-900 dark:text-white">결제수단별</h3>
							<div id="sales-pie-chart"></div>
						</div>
						<div data-popper-arrow></div>
					</div>
				</div>
				<div id="day-of-time-sales-chart"></div>
			</div>
			<div class="bg-white border border-gray-200 rounded-lg shadow-sm 2xl:col-span-2 dark:border-gray-700 dark:bg-gray-800 px-4 pt-4 sm:px-4 sm:pt-4">
				<div class="flex items-center justify-between mb-2">
					<div class="flex-shrink-0">
						<h3 class="text-base font-light text-gray-500 dark:text-gray-400">
							최근 7일 매출액(예시)
						</h3>
						<span
							class="text-2xl font-bold leading-none text-gray-900 sm:text-3xl dark:text-white"
						>{numberWithCommas(4251000)} 원</span>
					</div>
				</div>
				<div id="week-sales-chart"></div>
			</div>
		</div>
		<!-- Right widget -->
		<div class="grid gap-4 w-full">
			<div class="grid gap-4 w-full grid-cols-1 xl:grid-cols-2 2xl:grid-cols-2">
				<div class="grid gap-4 w-full">
					<!-- Monthly Chart -->
					<div class="w-full bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-gray-800 px-4 pt-4 sm:px-4 sm:pt-4">
						<div class="flex justify-between border-gray-200 border-b dark:border-gray-700 pb-3">
							<dl>
								<dt class="text-base font-normal text-gray-500 dark:text-gray-400 pb-1">월별 매출액 |
									<span class="text-base font-normal">단위: 원(1K = 1,000)</span></dt>
								<dd class="leading-none text-3xl font-bold text-gray-900 dark:text-white">{numberWithCommas(99999999)} 원</dd>
							</dl>
						</div>
						<div class="grid grid-cols-2 py-3">
							<dl>
								<dt class="text-base font-normal text-gray-500 dark:text-gray-400 pb-1">이번 달 매출액</dt>
								<dd class="leading-none text-xl font-bold text-green-500 dark:text-green-400">23,635k</dd>
							</dl>
							<dl>
								<dt class="text-base font-normal text-gray-500 dark:text-gray-400 pb-1">이번 달 취소액</dt>
								<dd class="leading-none text-xl font-bold text-red-600 dark:text-red-500">-18,230k
									<button data-popover-target="cancel-description" data-popover-placement="bottom-end" type="button">
										<svg class="w-4 h-4 ml-2 text-gray-400 hover:text-gray-500" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
											<path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
										</svg>
										<span class="sr-only">Show information</span>
									</button>
									<div data-popover id="cancel-description" role="tooltip" class="absolute z-10 invisible inline-block text-sm font-light text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 w-72 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-400">
										<div class="p-3 space-y-2">
											<h3 class="font-semibold text-gray-900 dark:text-white">설명</h3>
											<p>'취소액'은 '취소일' 기준으로 집계됩니다. (과거 거래 취소 시, 취소한 달에 포함)</p>
										</div>
										<div data-popper-arrow></div>
									</div>
								</dd>
							</dl>
						</div>
						<div id="monthly-chart"></div>
						<div class="grid grid-cols-1 items-center border-gray-200 border-t dark:border-gray-700 justify-between">
							<div class="flex justify-between items-center py-3">
								<a
									href="#"
									class="uppercase text-sm font-semibold inline-flex items-center rounded-lg text-blue-600 hover:text-blue-700 dark:hover:text-blue-500  hover:bg-gray-100 dark:hover:bg-gray-700 dark:focus:ring-gray-700 dark:border-gray-700 px-3 py-2">
									결제내역 집계 보러가기
									<svg class="w-2.5 h-2.5 ms-1.5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
										<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
									</svg>
								</a>
							</div>
						</div>
					</div>
					<!--AD Banner widget -->
					<div class="relative overflow-hidden w-full items-center justify-between bg-white border border-gray-200 rounded-lg dark:border-gray-700 dark:bg-gray-800" data-carousel="slide" id="ad-gallery">
						<div class="relative overflow-hidden rounded-lg h-full">
							<!-- Item 1 -->
							<div class="overflow-hidden hidden duration-700 ease-out" data-carousel-item="active">
								<a href="#">
									<img src="https://image.ubcn.co.kr/vmms/20250516popup.png" class="absolute block -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2" alt="">
								</a>
							</div>
							<!-- Item 2 -->
							<div class="overflow-hidden  hidden duration-700 ease-out" data-carousel-item>
								<a href="#">
									<img src="https://image.ubcn.co.kr/vmms/Rental_service.jpg" class="absolute block -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2" alt="">
								</a>
							</div>
							<!-- Item 3 -->
							<div class="overflow-hidden  hidden duration-700 ease-out" data-carousel-item>
								<a href="#">
									<img src="https://image.ubcn.co.kr/vmms/20250508popup.png" class="absolute block -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2" alt="">
								</a>
							</div>
						</div>
						<!-- Slider controls -->
						<button type="button" class="absolute top-0 start-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none" data-carousel-prev>
																																							        <span class="inline-flex items-center justify-center w-10 h-10 bg-opacity-50 rounded-full bg-gray-500 dark:bg-gray-800/30 group-hover:bg-gray-600 dark:group-hover:bg-gray-800/60 group-focus:ring-4 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
																																							            <svg class="w-4 h-4 text-white dark:text-gray-800 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
																																							                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/>
																																							            </svg>
																																							            <span class="sr-only">Previous</span>
																																							        </span>
						</button>
						<button type="button" class="absolute top-0 end-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group focus:outline-none" data-carousel-next>
																																							        <span class="inline-flex items-center justify-center w-10 h-10 bg-opacity-50 rounded-full bg-gray-500 dark:bg-gray-800/30 group-hover:bg-gray-600 dark:group-hover:bg-gray-800/60 group-focus:ring-4 group-focus:ring-white dark:group-focus:ring-gray-800/70 group-focus:outline-none">
																																							            <svg class="w-4 h-4 text-white dark:text-gray-800 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
																																							                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
																																							            </svg>
																																							            <span class="sr-only">Next</span>
																																							        </span>
						</button>
					</div>
				</div>
				<!--Right on Right-->
				<div class="grid gap-4 w-full">
					<!-- Terminal Donut chart -->
					<div class="p-4 mb-4 bg-white border border-gray-200 rounded-lg shadow-sm dark:border-gray-700 sm:p-4 dark:bg-gray-800 xl:mb-0">
						<h3 class="text-lg font-medium text-gray-900 dark:text-white">단말기 상태정보 수신현황</h3>
						<div class="items-center" id="status-by-terminal"></div>
					</div>
					<!-- Notice & FAQ Tab -->
					<div class="bg-white border border-gray-200 rounded-lg shadow-sm dark:border-gray-700 dark:bg-gray-800 px-4 pt-4 sm:px-4 sm:pt-4">
						<div class="flex items-center justify-between mb-2">
							<h3 class="text-lg font-medium text-gray-900 dark:text-white">
								공지사항 & 자주묻는질문
							</h3>
							<a href="/" class="inline-flex items-center p-2 text-sm font-medium rounded-lg text-primary-700 hover:bg-gray-100 dark:text-primary-500 dark:hover:bg-gray-700">
								전체보기
							</a>
						</div>
						<ul
							class="hidden text-sm font-medium text-center text-gray-500 divide-x divide-gray-200 rounded-lg sm:flex dark:divide-gray-600 dark:text-gray-400"
							id="fullWidthTab"
							data-tabs-toggle="#fullWidthTabContent"
							role="tablist"
						>
							<li class="w-full">
								<button
									id="notice-tab"
									data-tabs-target="#notice"
									type="button"
									role="tab"
									aria-controls="notice"
									aria-selected="true"
									class="inline-block w-full p-2 rounded-tl-lg bg-gray-50 hover:bg-gray-100 focus:outline-none dark:bg-gray-700 dark:hover:bg-gray-600"
								>공지사항
								</button
								>
							</li>
							<li class="w-full">
								<button
									id="about-tab"
									data-tabs-target="#about"
									type="button"
									role="tab"
									aria-controls="about"
									aria-selected="false"
									class="inline-block w-full p-2 rounded-tr-lg bg-gray-50 hover:bg-gray-100 focus:outline-none dark:bg-gray-700 dark:hover:bg-gray-600"
								>자주묻는질문
								</button
								>
							</li>
						</ul>
						<div
							id="fullWidthTabContent"
							class="border-t border-gray-200 dark:border-gray-600"
						>
							<div
								class="hidden pt-4"
								id="notice"
								role="tabpanel"
								aria-labelledby="notice-tab"
							>
								<ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
									{
										notices?.map((notice) =>
											<li class="mb-4 ml-4" key={notice.id}>
												<div
													class="absolute w-3 h-3 bg-gray-200 rounded-full mt-1.5 -left-1.5 border border-white dark:border-gray-800 dark:bg-gray-700"></div>
												<time
													class="mb-1 text-sm font-normal leading-none text-gray-400 dark:text-gray-500">{notice.createdAt}</time>
												<!--<h3 class="text-lg font-medium text-gray-900 dark:text-white">{notice.title}</h3>-->
												<!-- 미표기 -->
												<p class="text-base font-normal text-gray-900 dark:text-white">
													<!--dangerouslySetInnerHTML={{__html: notice.content.slice(0, 100)}}-->{notice.title}
												</p>
											</li>
										)
									}
								</ul>
							</div>
							<div
								class="hidden pt-4"
								id="about"
								role="tabpanel"
								aria-labelledby="about-tab"
							>
								<ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
									{
										notices?.map((notice) =>
											<li class="mb-4 ml-4" key={notice.id}>
												<div
													class="absolute w-3 h-3 bg-gray-200 rounded-full mt-1.5 -left-1.5 border border-white dark:border-gray-800 dark:bg-gray-700"></div>
												<time
													class="mb-1 text-sm font-normal leading-none text-gray-400 dark:text-gray-500">{"자주묻는질문 테스트 중"}</time>
												<!--<h3 class="text-lg font-medium text-gray-900 dark:text-white">{notice.title}</h3>-->
												<!-- 미표기 -->
												<p class="text-base font-normal text-gray-900 dark:text-white">
													<!--dangerouslySetInnerHTML={{__html: notice.content.slice(0, 100)}}-->{notice.title}
												</p>
											</li>
										)
									}
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	//import './DashBoard.client.js';
	import {getDayOfTimeSalesChart, getWeekSalesChart} from "./DashBoard.client.js";

	//const getDayOfTimeSalesList = await fetch(`${API_URL}/list/todaySalesList`).then((response) => response.json());
	const getDayOfTimeSalesList =
		{
			today: [4900, 2500, 6700, 8900, 5600, 9900, 6000, 10900, 84000, 75900, 90000, 82000, 60100, 99700, 81000, 92400, 83100, 77300, 62500, 79900, 47300, 70200, 16000, 9800,],
			yesterday: [6000, 8300, 1400, 900, 5600, 7000, 6400, 18400, 65500, 73300, 91100, 85000, 99100, 78700, 60000, 79900, 69800, 87600, 78000, 62100, 40800, 85000, 23000, 7100,],
		};
	const getWeekSalesList = {
		amounts: [981000, 223000, 510000, 614000, 398000, 650000, 875000,],
		counts: [981, 223, 510, 614, 398, 650, 875,]
	};

	getDayOfTimeSalesChart(getDayOfTimeSalesList.today, getDayOfTimeSalesList.yesterday);
	getWeekSalesChart(getWeekSalesList.amounts, getWeekSalesList.counts);

</script>
<style is:inline>
	@media (min-width: 360px) {
		/*실제로는 hidden*/
		#gallery img {
			width: 50% !important;
		}
		#ad-gallery {
			min-height: 150px !important;
		}
	}
	
	@media (min-width: 640px) {
		/*실제로는 hidden*/
		#gallery img {
			width: 50% !important;
		}
		#ad-gallery {
			min-height: 150px !important;
		}
	}

	@media (min-width: 1024px) {
		/*실제로는 hidden*/
		#gallery img {
			width: 50% !important;
		}

		#ad-gallery {
			min-height: 150px !important;
		}
	}

	@media (min-width: 1280px) {
		#gallery img {
			width: 50% !important;
		}

		#ad-gallery {
			min-height: 150px !important;
		}
	}

	@media (min-width: 1536px) {
		#gallery img {
			width: 90% !important;
		}

		#ad-gallery {
			min-height: 150px !important;
		}
	}
</style>
<style is:global>
	/* chart styles */
	.apexcharts-tooltip {
		@apply bg-white dark:bg-gray-700 text-gray-500 dark:text-gray-400 border-0 rounded-lg shadow-lg !important;
	}

	.apexcharts-tooltip .apexcharts-tooltip-title {
		@apply py-2 px-4 bg-gray-100 dark:bg-gray-600 border-b border-gray-200 dark:border-gray-500 !important;
	}

	.apexcharts-xaxistooltip {
		@apply text-gray-500 border-0 bg-white dark:bg-gray-700 dark:text-gray-300 rounded-lg shadow-lg !important;
	}

	.apexcharts-tooltip .apexcharts-tooltip-text-y-value {
		@apply dark:text-white;
	}

	.apexcharts-xaxistooltip-text {
		@apply font-medium text-sm !important;
	}

	.apexcharts-xaxistooltip:before,
	.apexcharts-xaxistooltip:after {
		@apply border-0 !important;
	}
</style>
